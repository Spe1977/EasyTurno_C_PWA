import { Injectable, signal } from '@angular/core';

@Injectable({ providedIn: 'root' })
export class TranslationService {
  language = signal<'it' | 'en'>(this.getInitialLanguage());

  private translations: Record<'it' | 'en', Record<string, string>> = {
    it: {
      'appTitle': 'EasyTurno',
      'addShift': 'Aggiungi Turno',
      'settings': 'Impostazioni',
      'language': 'Lingua',
      'save': 'Salva',
      'cancel': 'Chiudi',
      'delete': 'Elimina',
      'editShift': 'Modifica Turno',
      'newShift': 'Nuovo Turno',
      'title': 'Titolo',
      'startDate': 'Data Inizio',
      'startTime': 'Ora Inizio',
      'endDate': 'Data Fine',
      'endTime': 'Ora Fine',
      'color': 'Colore',
      'repetition': 'Ripetizione',
      'doesNotRepeat': 'Non si ripete',
      'days': 'Giorni',
      'weeks': 'Settimane',
      'months': 'Mesi',
      'year': 'Anno',
      'every': 'Ogni',
      'deleteShiftConfirm': 'Sei sicuro di voler eliminare questo turno?',
      'deleteSeriesConfirm': 'Questo è un turno ricorrente. Vuoi eliminare solo questo evento, o l\'intera serie?',
      'deleteThisOccurrence': 'Solo questo evento',
      'deleteAllFollowing': 'Tutta la serie',
      'editSeriesConfirm': 'Questo è un turno ricorrente. Vuoi modificare solo questo evento o l\'intera serie?',
      'editThisOccurrence': 'Solo questo evento',
      'editAllFollowing': 'Tutta la serie',
      'backupRestore': 'Backup e Ripristino',
      'exportBackup': 'Esporta Backup',
      'importBackup': 'Importa Backup',
      'importSuccess': 'Backup importato con successo!',
      'importError': 'File di backup non valido.',
      'resetAllData': 'Resetta Tutti i Dati',
      'resetConfirm': 'ATTENZIONE: Stai per eliminare tutti i dati. Questa azione è irreversibile. Sei sicuro?',
      'resetSuccess': 'Tutti i dati sono stati cancellati.',
      'noShifts': 'Nessun turno da mostrare.',
      'theme': 'Tema',
      'light': 'Chiaro',
      'dark': 'Scuro',
      'loadMore': 'Carica altro',
      'searchDate': 'Cerca Data',
      'search': 'Cerca',
      'showingResultsFor': 'Risultati per',
      'clearSearch': 'Pulisci Ricerca',
      'noShiftsForDate': 'Nessun turno per questa data.',
      'notes': 'Note',
      'overtimeHours': 'Ore di Straordinario',
      'allowances': 'Indennità',
      'addAllowance': 'Aggiungi Indennità',
      'allowanceName': 'Nome Indennità',
      'allowanceAmount': 'Importo',
      'remove': 'Rimuovi',
      'statistics': 'Statistiche',
      'periodFrom': 'Periodo dal',
      'periodTo': 'al',
      'totalShifts': 'Totale Turni',
      'totalHours': 'Ore Totali Lavorate',
      'totalOvertime': 'Ore Straordinario Totali',
      'shiftsByType': 'Turni per Tipo',
      'allowancesByType': 'Indennità per Tipo',
      'noData': 'Nessun dato disponibile per questo periodo',
      'hours': 'ore',
    },
    en: {
      'appTitle': 'EasyTurno',
      'addShift': 'Add Shift',
      'settings': 'Settings',
      'language': 'Language',
      'save': 'Save',
      'cancel': 'Cancel',
      'delete': 'Delete',
      'editShift': 'Edit Shift',
      'newShift': 'New Shift',
      'title': 'Title',
      'startDate': 'Start Date',
      'startTime': 'Start Time',
      'endDate': 'End Date',
      'endTime': 'End Time',
      'color': 'Color',
      'repetition': 'Repetition',
      'doesNotRepeat': 'Does not repeat',
      'days': 'Days',
      'weeks': 'Weeks',
      'months': 'Months',
      'year': 'Year',
      'every': 'Every',
      'deleteShiftConfirm': 'Are you sure you want to delete this shift?',
      'deleteSeriesConfirm': 'This is a recurring shift. Do you want to delete only this event, or the entire series?',
      'deleteThisOccurrence': 'Only this event',
      'deleteAllFollowing': 'The entire series',
      'editSeriesConfirm': 'This is a recurring shift. Do you want to update just this event or the entire series?',
      'editThisOccurrence': 'Just this event',
      'editAllFollowing': 'The entire series',
      'backupRestore': 'Backup & Restore',
      'exportBackup': 'Export Backup',
      'importBackup': 'Import Backup',
      'importSuccess': 'Backup imported successfully!',
      'importError': 'Invalid backup file.',
      'resetAllData': 'Reset All Data',
      'resetConfirm': 'WARNING: You are about to delete all data. This action is irreversible. Are you sure?',
      'resetSuccess': 'All data has been deleted.',
      'noShifts': 'No shifts to display.',
      'theme': 'Theme',
      'light': 'Light',
      'dark': 'Dark',
      'loadMore': 'Load More',
      'searchDate': 'Search Date',
      'search': 'Search',
      'showingResultsFor': 'Showing results for',
      'clearSearch': 'Clear Search',
      'noShiftsForDate': 'No shifts for this date.',
      'notes': 'Notes',
      'overtimeHours': 'Overtime Hours',
      'allowances': 'Allowances',
      'addAllowance': 'Add Allowance',
      'allowanceName': 'Allowance Name',
      'allowanceAmount': 'Amount',
      'remove': 'Remove',
      'statistics': 'Statistics',
      'periodFrom': 'Period from',
      'periodTo': 'to',
      'totalShifts': 'Total Shifts',
      'totalHours': 'Total Hours Worked',
      'totalOvertime': 'Total Overtime Hours',
      'shiftsByType': 'Shifts by Type',
      'allowancesByType': 'Allowances by Type',
      'noData': 'No data available for this period',
      'hours': 'hours',
    }
  };

  private getInitialLanguage(): 'it' | 'en' {
    const storedLang = localStorage.getItem('easyturno_lang');
    if (storedLang === 'it' || storedLang === 'en') {
      return storedLang;
    }
    const browserLang = navigator.language.split('-')[0];
    return browserLang === 'it' ? 'it' : 'en';
  }

  setLanguage(lang: 'it' | 'en') {
    this.language.set(lang);
    localStorage.setItem('easyturno_lang', lang);
  }

  translate(key: string): string {
    return this.translations[this.language()][key] || key;
  }
}